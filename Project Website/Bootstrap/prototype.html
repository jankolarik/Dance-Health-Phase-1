<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Dance Health</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/modern-business.css" rel="stylesheet">

</head>

<body>
  
  <!-- Navigation -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">Home</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="requirements.html">Requirements</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="researchAndExperiments.html">Research & Experiments</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="testing.html">Testing</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="achievements.html">Achievements</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="prototype.html">Prototype</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="termTwoPlan.html">Term 2 Plan</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="appendices.html">Appendices</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">Contact</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownBlog" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              HCI
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownBlog">
              <a class="dropdown-item" href="userRequirementsHCI.html">User Requirements</a>
              <a class="dropdown-item" href="personasAndSketchesHCI.html">Personas and Sketches</a>

            </div>
          </li>

        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container">

        <!-- Page Heading/Breadcrumbs -->
        <h1 class="mt-4 mb-3">Prototype</h1>
    
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="index.html">Home</a>
          </li>
          <li class="breadcrumb-item active">Prototype</li>
        </ol>

    <h3>Prototype 1:</h3>
    <p>Our first prototype consisted of a functional and presentable Apple Watch App as well as a fully functional Kinect App.
      The Apple Watch app uses the gyroscope, accelerometer, and heartrate sensor to detect user activity, spins, and health data, and outputs them in a <a href="https://www.hl7.org/fhir/">FHIR</a> Standard format.
      The Kinect App can detect user skeletals and calculate activity rate of the user as well as other health metrics (like maximum limb height, for example, which could be useful in the
      context of rehabilitation and physical therapy), and outputs these metrics in a file. It can also display the live video feed, and overlay the live skeletals over it.
      In addition, it can create a video file for the user to see their session later.</p>
    </p>
        <h3>System Architecture Plan:</h3>
        <p>The following is a system design diagram of how the Kinect Apple Watch will be integrated in the future: while the separate systems for both devices are currently mostly finished, the integration is still in the works.</p>
        <img src="./images/diagram.png" alt="System Architecture Design" width="700" height="500">

    <h3>Implementation</h3>
    <p><b>The Apple Watch code works in the following way.</b><br/>
      <br/>
      Initially all the variables are initialised and the application checks whether the user has granted it access to use the sensors and their medical data. If not, the application will prompt the user if they will allow this.<br/>
      There is a global state variable, which tells functions whether the user is dancing or not. If currentState = 1, the session is active and if currentState = 0, the session is inactive. Whenever the session is active, a lot of background calculations are being run.<br/>
      The Apple Watch will constantly record the user heart rate with the heart rate sensor along with getting accelerometer and gyroscope data. With this data it calculates the number of calories burned and distance travelled (which is implemented by Apple and an API is called for this) along with tracking the number of spins, which is implemented by us. It does this by using data from two of the sensors which is updates every 0.3seconds. This feature is implemented in the motionData() function.<br/>
      After the user presses stop, the currentState will change and this button click will initiate the process for ending a workout. It will call on Apple's HealthKit API, to log the workout results into the Activity Application in a FHIR standard. The button will reset to display „Start Dancing“ again.<br/>
      <br/>
      <br/>
      <b>Kinect Implementation</b><br/>
      <br/>
      We have a class called SkeletalTracking which include all of our Kinect code. In the main function, we first initialise the glut and OpenCV setting which are responsible for our video display and skeletal drawing. Then we call a series of OpenGL functions to initialise the textures of our display screen, then to setup the screen and camera. Then, we call the glut main loop: this calls all the functions we want to loop, as we call them inside the draw() function (which is defined as the default function that runs if the program is idle).<br/>
      This video should then theoretically be saved in a .avi file at the end of the session.<br/>
      The Kinect library provides us with an object called IBodyFrame which allow us to obtain the bodies inside the camera view, those bodies are stored in object called IBody which are returned as a list contain up to 6 IBody which is the maximum number of people Kinect can track at the same time. These IBody
      can provides us the tracing state of this body and also joints data, includes joints X,Y,Z coordinates and their tracking state.<br/>
      In the update function, we first call functions to acquire the latest frame and body data. If that process succeed, we enter a series of if conditions blocks, we currently have 3 blocks which represent the different part of the dance process, start from calibration session, then body process session, and the last one which is the summary session. After each session is finished, we set the condition of current block to false so that it fall into the next session.<br/>
      In these functions, we are defining a position to let people move to next session without the need to touch any devices, the current position require you to raise both of your hands above the head for 3-5 seconds, this can be changed to any other position if needed.<br/>
      Inside the calibration function, we are calculating the height of floor from the height of feet joint by letting user stand still for a few seconds, the purpose is to calculate joints data relative to the floor height as Kinect has its coordinate system relative to the camera instead of floor.<br/>
      Then inside process body function, we now have activity level and max height functions. The activity level calculate the distance moved of each joint per frame by storing the previous frame data and compare it to the current frame. The max height function detect max height of joints (currently both hands and knees) by replacing any height that is higher than the current maximum.<br/>
      Then in the summary session, we write those data obtained by the process body session and also local time data into a txt file.
    </p>
    <h3>Prototype Demo:</h3>
    <p>We filmed a demo of our first prototype:</p>
    <div class="col-lg-6">
      <iframe width="700" height="450" src="https://www.youtube.com/embed/7ev9H3-h-ls" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
    <br/>
    <h3>Elevator Pitch</h3>
    <p>We also gave a 2 minute pitch for this prototype:</p>
    <div class = "row">
    <iframe src="https://drive.google.com/file/d/1LxDHvAkr5QiPOquA5d4hkEAJDB7IEnx1/preview" width="610" height="400"></iframe>
      <img src="./images/PicPitch.png" alt="Pitch" width="510" height="400">
    </div>
      </div>
      <!-- /.container -->

  <!-- Footer -->
  <footer class="py-5 bg-dark">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; Team 32, 2020</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>
